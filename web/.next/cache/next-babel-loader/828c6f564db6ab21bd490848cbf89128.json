{"ast":null,"code":"import _classCallCheck from \"/Users/pflaxalt/Repositories/_pfl/web/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/pflaxalt/Repositories/_pfl/web/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _defineProperty from \"/Users/pflaxalt/Repositories/_pfl/web/node_modules/@babel/runtime/helpers/esm/defineProperty\";\n// Core\nimport * as THREE from \"three\"; // Settings\n\n// Textures\nimport { EffectComposer, RenderPass, EffectPass } from \"postprocessing\"; // Textures\n\nimport { TouchTexture } from \"./water-distort/TouchTexture\";\nimport WaterEffect from \"./water-distort/WaterEffect\";\nimport { hexToRGB } from \"../../utils/hexToRGB\"; // Begin Component\n// __________________________________________________________________________\n\nexport var ThreeWaterCanvasClass = /*#__PURE__*/function () {\n  // ______________________________\n  // Types\n  // ______________________________\n  // Constructor\n  function ThreeWaterCanvasClass(options) {\n    _classCallCheck(this, ThreeWaterCanvasClass);\n\n    _defineProperty(this, \"touchTexture\", void 0);\n\n    _defineProperty(this, \"waterEffect\", void 0);\n\n    _defineProperty(this, \"renderer\", void 0);\n\n    _defineProperty(this, \"camera\", void 0);\n\n    _defineProperty(this, \"scene\", void 0);\n\n    _defineProperty(this, \"composer\", void 0);\n\n    _defineProperty(this, \"fov\", void 0);\n\n    _defineProperty(this, \"clock\", void 0);\n\n    _defineProperty(this, \"material\", void 0);\n\n    _defineProperty(this, \"mesh\", void 0);\n\n    _defineProperty(this, \"canvasElement\", void 0);\n\n    _defineProperty(this, \"geometry\", void 0);\n\n    this.touchTexture = new TouchTexture({\n      debug: true\n    });\n    this.renderer = new THREE.WebGLRenderer({\n      antialias: false,\n      alpha: true\n    });\n    this.renderer.setSize(window.innerWidth, window.innerHeight);\n    this.renderer.setPixelRatio(window.devicePixelRatio);\n    this.renderer.domElement.id = \"three_canvas\";\n    options.canvasContainer.append(this.renderer.domElement); // Scene\n\n    this.fov = 45;\n    this.camera = new THREE.PerspectiveCamera(this.fov, window.innerWidth / window.innerHeight, 0.1, 10000);\n    this.camera.position.z = 50;\n    this.scene = new THREE.Scene();\n    this.scene.background = new THREE.Color(\"\".concat(hexToRGB(window.laxaltUniversalTheme.background, 1)));\n    this.canvasElement = options.canvasElement;\n    this.geometry = new THREE.PlaneBufferGeometry(window.innerWidth / (this.fov / 1.75), window.innerHeight / (this.fov / 1.75), 1, 1);\n    this.material = new THREE.MeshBasicMaterial();\n    this.mesh = new THREE.Mesh(this.geometry, this.material);\n    this.material.map = new THREE.CanvasTexture(this.canvasElement);\n    this.tick = this.tick.bind(this);\n    this.onMouseMove = this.onMouseMove.bind(this); // Post Processing\n\n    this.composer = new EffectComposer(this.renderer);\n    this.clock = new THREE.Clock();\n    this.init();\n  }\n\n  _createClass(ThreeWaterCanvasClass, [{\n    key: \"initComposer\",\n    value: function initComposer() {\n      var renderPass = new RenderPass(this.scene, this.camera);\n      this.waterEffect = new WaterEffect({\n        texture: this.touchTexture.texture\n      });\n      var waterPass = new EffectPass(this.camera, this.waterEffect);\n      renderPass.renderToScreen = false;\n      waterPass.renderToScreen = true;\n      this.composer.addPass(renderPass);\n      this.composer.addPass(waterPass);\n    }\n  }, {\n    key: \"watchPlane\",\n    value: function watchPlane() {\n      window.addEventListener(\"mousemove\", this.onMouseMove);\n      this.scene.add(this.mesh);\n    }\n  }, {\n    key: \"init\",\n    value: function init() {\n      this.initComposer();\n      this.watchPlane();\n      this.tick();\n    }\n  }, {\n    key: \"onMouseMove\",\n    value: function onMouseMove(ev) {\n      var point = {\n        x: ev.clientX / window.innerWidth,\n        y: ev.clientY / window.innerHeight\n      };\n      this.touchTexture.addPoint(point);\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      this.material.map.needsUpdate = true;\n      this.scene.background = new THREE.Color(\"\".concat(hexToRGB(window.laxaltUniversalTheme.background, 1)));\n      this.composer.render(this.clock.getDelta());\n    }\n  }, {\n    key: \"tick\",\n    value: function tick() {\n      if (document.querySelector(\"#three_canvas\")) {\n        this.render();\n        this.touchTexture.update();\n        requestAnimationFrame(this.tick);\n      } else {\n        this.renderer = null;\n        this.composer = null;\n        this.scene = null;\n        return;\n      }\n    }\n  }]);\n\n  return ThreeWaterCanvasClass;\n}();\nexport var ThreeWaterCanvas = function ThreeWaterCanvas(canvasContainer, canvasElement) {\n  if (!document.querySelector(\"#three_canvas\")) {\n    var myWaterCanvas = new ThreeWaterCanvasClass({\n      canvasContainer: canvasContainer,\n      canvasElement: canvasElement\n    });\n    return myWaterCanvas;\n  } else {\n    document.querySelector(\"#three_canvas\").remove();\n\n    var _myWaterCanvas = new ThreeWaterCanvasClass({\n      canvasContainer: canvasContainer,\n      canvasElement: canvasElement\n    });\n\n    return _myWaterCanvas;\n  }\n};\n_c = ThreeWaterCanvas;\n\nvar _c;\n\n$RefreshReg$(_c, \"ThreeWaterCanvas\");","map":{"version":3,"sources":["/Users/pflaxalt/Repositories/_pfl/web/sketches/three/three-water-distort.canvas.ts"],"names":["THREE","EffectComposer","RenderPass","EffectPass","TouchTexture","WaterEffect","hexToRGB","ThreeWaterCanvasClass","options","touchTexture","debug","renderer","WebGLRenderer","antialias","alpha","setSize","window","innerWidth","innerHeight","setPixelRatio","devicePixelRatio","domElement","id","canvasContainer","append","fov","camera","PerspectiveCamera","position","z","scene","Scene","background","Color","laxaltUniversalTheme","canvasElement","geometry","PlaneBufferGeometry","material","MeshBasicMaterial","mesh","Mesh","map","CanvasTexture","tick","bind","onMouseMove","composer","clock","Clock","init","renderPass","waterEffect","texture","waterPass","renderToScreen","addPass","addEventListener","add","initComposer","watchPlane","ev","point","x","clientX","y","clientY","addPoint","needsUpdate","render","getDelta","document","querySelector","update","requestAnimationFrame","ThreeWaterCanvas","myWaterCanvas","remove"],"mappings":"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","sourcesContent":["// Core\nimport * as THREE from \"three\";\n\n// Settings\nimport { __DEBUG__ } from \"../../constants/site/Settings\";\n\n// Types\nimport { LXLT_ColorTheme } from \"../../constants/styles/Color\";\n\n// Textures\nimport { EffectComposer, RenderPass, EffectPass } from \"postprocessing\";\n\n// Textures\nimport {\n  LXLT_TouchTexturePoint,\n  TouchTexture,\n} from \"./water-distort/TouchTexture\";\nimport WaterEffect from \"./water-distort/WaterEffect\";\nimport { hexToRGB } from \"../../utils/hexToRGB\";\n\n// Begin Component\n// __________________________________________________________________________\n\nexport type LXLT_ThreeWaterCanvas = {\n  canvasContainer: HTMLDivElement;\n  canvasElement: HTMLCanvasElement;\n};\n\nexport class ThreeWaterCanvasClass {\n  // ______________________________\n  // Types\n  touchTexture: TouchTexture;\n  waterEffect: WaterEffect;\n  renderer: THREE.WebGLRenderer;\n  camera: THREE.PerspectiveCamera;\n  scene: THREE.Scene;\n  composer: any;\n  fov: number;\n  clock: THREE.Clock;\n  material: THREE.MeshBasicMaterial;\n  mesh: THREE.Mesh;\n  canvasElement: HTMLCanvasElement;\n  geometry: THREE.PlaneBufferGeometry;\n\n  // ______________________________\n  // Constructor\n  constructor(options: LXLT_ThreeWaterCanvas) {\n    this.touchTexture = new TouchTexture({ debug: true });\n\n    this.renderer = new THREE.WebGLRenderer({\n      antialias: false,\n      alpha: true,\n\n    });\n\n    this.renderer.setSize(window.innerWidth, window.innerHeight);\n    this.renderer.setPixelRatio(window.devicePixelRatio);\n    this.renderer.domElement.id = \"three_canvas\";\n\n    options.canvasContainer.append(this.renderer.domElement);\n\n    // Scene\n    this.fov = 45;\n\n    this.camera = new THREE.PerspectiveCamera(\n      this.fov,\n      window.innerWidth / window.innerHeight,\n      0.1,\n      10000\n    );\n    this.camera.position.z = 50;\n\n    this.scene = new THREE.Scene();\n    this.scene.background = new THREE.Color(\n      `${hexToRGB(window.laxaltUniversalTheme.background, 1)}`\n    );\n\n    this.canvasElement = options.canvasElement;\n\n    this.geometry = new THREE.PlaneBufferGeometry(window.innerWidth / (this.fov / 1.75), window.innerHeight / (this.fov / 1.75), 1, 1);\n    this.material = new THREE.MeshBasicMaterial();\n    this.mesh = new THREE.Mesh(this.geometry, this.material);\n\n    this.material.map = new THREE.CanvasTexture(this.canvasElement);\n\n    this.tick = this.tick.bind(this);\n    this.onMouseMove = this.onMouseMove.bind(this);\n\n    // Post Processing\n    this.composer = new EffectComposer(this.renderer);\n    this.clock = new THREE.Clock();\n\n    this.init();\n  }\n\n  initComposer() {\n    const renderPass = new RenderPass(this.scene, this.camera);\n\n    this.waterEffect = new WaterEffect({ texture: this.touchTexture.texture });\n\n    const waterPass = new EffectPass(this.camera, this.waterEffect);\n\n    renderPass.renderToScreen = false;\n    waterPass.renderToScreen = true;\n    this.composer.addPass(renderPass);\n    this.composer.addPass(waterPass);\n  }\n\n  watchPlane() {\n    window.addEventListener(\"mousemove\", this.onMouseMove);\n    this.scene.add(this.mesh);\n  }\n\n  init() {\n    this.initComposer();\n    this.watchPlane();\n    this.tick();\n  }\n\n  onMouseMove(ev: MouseEvent) {\n    const point: LXLT_TouchTexturePoint = {\n      x: ev.clientX / window.innerWidth,\n      y: ev.clientY / window.innerHeight,\n    };\n    this.touchTexture.addPoint(point);\n  }\n\n  render() {\n    this.material.map.needsUpdate = true;\n\n    this.scene.background = new THREE.Color(\n      `${hexToRGB(window.laxaltUniversalTheme.background, 1)}`\n    );\n\n    this.composer.render(this.clock.getDelta());\n  }\n\n  tick() {\n    if (document.querySelector(\"#three_canvas\")) {\n      this.render();\n      this.touchTexture.update();\n\n      requestAnimationFrame(this.tick);\n    } else {\n      this.renderer = null;\n      this.composer = null;\n      this.scene = null;\n\n      return;\n    }\n  }\n}\n\nexport const ThreeWaterCanvas = (\n  canvasContainer: HTMLDivElement,\n  canvasElement: HTMLCanvasElement\n): ThreeWaterCanvasClass => {\n  if (!document.querySelector(\"#three_canvas\")) {\n    const myWaterCanvas = new ThreeWaterCanvasClass({\n      canvasContainer,\n      canvasElement,\n    });\n\n    return myWaterCanvas;\n  } else {\n    document.querySelector(\"#three_canvas\").remove();\n\n    const myWaterCanvas = new ThreeWaterCanvasClass({\n      canvasContainer,\n      canvasElement,\n    });\n\n    return myWaterCanvas;\n  }\n};\n"]},"metadata":{},"sourceType":"module"}